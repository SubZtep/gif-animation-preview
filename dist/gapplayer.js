function gapStart(){"yes"===gapParams.metadata&&jQuery('img[src$="-gap.jpg"]:not([data-gif]):not(.gapplayer),img[src*="-gap.jpg?"]:not([data-gif]):not(.gapplayer)').each(function(){var e=jQuery(this).attr("src");jQuery(this).attr("data-gif",e.substring(0,e.length-8)+".gif")});var t={autoLoad:"yes"==gapParams.autoLoad,preLoad:"no"==gapParams.preLoad,effect:"yes"==gapParams.effect,hover:"yes"==gapParams.hover},i=[];jQuery("img[data-gif]").each(function(){var e=jQuery(this);e.hasClass("lazy-hidden")?e.on("lazyloaded",function(){e.imagesLoaded(function(){e.gapPlayer(t)}),e.off("lazyloaded")}):i.push(e)});var e=jQuery(i);e.imagesLoaded(function(){e.gapPlayer(t)})}!function(s){function t(e,t){this.previewElement=e,this.spinnerElement=s("<div class='spinner'></div>"),this.options=t,this.gifLoaded=!1}t.prototype={activate:function(){this.wrap(),this.addSpinner(),this.addControl(),this.addEvents(),this.options.autoLoad&&(this.playElement.hide(),this.spinnerElement.show(),this.loadGif()),this.options.preLoad&&((new Image).src=this.getGifSrc())},wrap:function(){this.wrapper=this.previewElement.wrap("<div class='gapplayer-wrapper'></div>").parent(),this.wrapper.css("width",this.previewElement.width()),this.wrapper.css("height",this.previewElement.height()),this.previewElement.addClass("gapplayer"),this.previewElement.css("cursor","pointer")},getGifSrc:function(){return this.previewElement.attr("data-gif")?this.previewElement.attr("data-gif"):this.previewElement.attr("src").replace(/\.[^/.]+$/,".gif")},addControl:function(){this.playElement=s("<ins class='play-gif'>"+this.options.label+"</ins>"),this.playElement.css("left",this.previewElement.width()/2+this.playElement.width()/2),this.wrapper.append(this.playElement)},addEvents:function(){var e=this.options.hover?"mouseenter":"click",t=this;t.playElement.on(e,function(e){s(this).hide(),t.spinnerElement.show(),t.loadGif(),e.preventDefault(),e.stopPropagation()}),t.previewElement.on(e,function(e){t.playElement.is(":visible")&&(t.playElement.hide(),t.spinnerElement.show(),t.loadGif()),e.preventDefault(),e.stopPropagation()}),t.spinnerElement.on(e,function(e){e.preventDefault(),e.stopPropagation()})},loadGif:function(){this.gifLoaded||this.enableAbort();var t=this,e=t.options.hover?"mouseleave":"click",i=this.getGifSrc(),n=this.previewElement.width(),a=this.previewElement.height();t.gifElement=s("<img src='"+i+"' width='"+n+"' height=' "+a+" '/>"),this.gifElement.load(function(){t.gifLoaded=!0,t.resetEvents(),s(this).css({position:"absolute",top:"0",left:"0"}),t.options.effect?(t.gifElement.hide(),t.spinnerElement.hide(),t.wrapper.append(t.gifElement),t.gifElement.stop(!0).fadeIn(function(){t.previewElement.hide()})):(t.previewElement.hide(),t.wrapper.append(t.gifElement),t.spinnerElement.hide()),t.options.autoLoad||s(this).on(e,function(e){t.options.effect?(t.previewElement.show(),t.playElement.show(),s(this).stop(!0).fadeOut()):(s(this).remove(),t.previewElement.show(),t.playElement.show()),e.preventDefault(),e.stopPropagation()})})},enableAbort:function(){var t=this;this.previewElement.click(function(e){t.abortLoading(e)}),this.spinnerElement.click(function(e){t.abortLoading(e)})},abortLoading:function(e){this.spinnerElement.hide(),this.playElement.show(),e.preventDefault(),e.stopPropagation(),this.gifElement.off("load").on("load",function(e){e.preventDefault(),e.stopPropagation()}),this.resetEvents()},resetEvents:function(){this.previewElement.off("click"),this.playElement.off("click"),this.spinnerElement.off("click"),this.addEvents()},addSpinner:function(){this.wrapper.append(this.spinnerElement),this.spinnerElement.hide()}},s.fn.gapPlayer=function(e){return this.each(function(){e=s.extend({},s.fn.gapPlayer.defaults,e),new t(s(this),e).activate()})},s.fn.gapPlayer.defaults={label:"gif",autoLoad:!1,preLoad:!1,effect:!1,hover:!1},gapStart()}(jQuery);