function gapStart(){if(gapParams.metadata=="yes")jQuery('img[src$="-gap.jpg"]:not([data-gif]):not(.gapplayer),img[src*="-gap.jpg?"]:not([data-gif]):not(.gapplayer)').each(function(){var e=jQuery(this).attr("src");jQuery(this).attr("data-gif",e.substring(0,e.length-8)+".gif")});var e=jQuery('img[src$="-gap.jpg"]:not(.gapplayer),img[src*="-gap.jpg?"]:not(.gapplayer)');e.imagesLoaded(function(){e.gapPlayer({autoLoad:gapParams.autoLoad=="yes",preLoad:gapParams.preLoad=="no",effect:gapParams.effect=="yes",hover:gapParams.hover=="yes"})})}(function(e){function t(t,n){this.previewElement=t;this.spinnerElement=e("<div class='spinner'></div>");this.options=n;this.gifLoaded=false}t.prototype={activate:function(){this.wrap();this.addSpinner();this.addControl();this.addEvents();if(this.options.autoLoad){this.playElement.hide();this.spinnerElement.show();this.loadGif()}if(this.options.preLoad){(new Image).src=this.getGifSrc()}},wrap:function(){this.wrapper=this.previewElement.wrap("<div class='gapplayer-wrapper'></div>").parent();this.previewElement.addClass("gapplayer");this.previewElement.css("cursor","pointer")},getGifSrc:function(){var e;if(this.previewElement.attr("data-gif")){e=this.previewElement.attr("data-gif")}else{e=this.previewElement.attr("src").replace(/\.[^/.]+$/,".gif")}return e},addControl:function(){this.playElement=e("<ins class='play-gif'>"+this.options.label+"</ins>");this.wrapper.append(this.playElement)},addEvents:function(){var t=this.options.hover?"mouseenter":"click",n=this;n.playElement.on(t,function(t){e(this).hide();n.spinnerElement.show();n.loadGif();t.preventDefault();t.stopPropagation()});n.previewElement.on(t,function(e){if(n.playElement.is(":visible")){n.playElement.hide();n.spinnerElement.show();n.loadGif()}e.preventDefault();e.stopPropagation()});n.spinnerElement.on(t,function(e){e.preventDefault();e.stopPropagation()})},loadGif:function(){if(!this.gifLoaded){this.enableAbort()}var t=this,n=t.options.hover?"mouseleave":"click",r=this.getGifSrc(),i=this.previewElement.width(),s=this.previewElement.height();t.gifElement=e("<img src='"+r+"'/>");this.gifElement.load(function(){t.gifLoaded=true;t.resetEvents();e(this).css({position:"absolute",top:"0",left:"0","max-width":"100%",height:"auto"});if(t.options.effect){t.gifElement.hide();t.spinnerElement.hide();t.wrapper.append(t.gifElement);t.gifElement.stop(true).fadeIn(function(){t.previewElement.css({visibility:"hidden"})})}else{t.previewElement.css({visibility:"hidden"});t.wrapper.append(t.gifElement);t.spinnerElement.hide()}if(!t.options.autoLoad){e(this).on(n,function(n){if(t.options.effect){t.previewElement.css({visibility:"visible"});t.playElement.show();e(this).stop(true).fadeOut()}else{e(this).remove();t.previewElement.css({visibility:"visible"});t.playElement.show()}n.preventDefault();n.stopPropagation()})}})},enableAbort:function(){var e=this;this.previewElement.click(function(t){e.abortLoading(t)});this.spinnerElement.click(function(t){e.abortLoading(t)})},abortLoading:function(e){this.spinnerElement.hide();this.playElement.show();e.preventDefault();e.stopPropagation();this.gifElement.off("load").on("load",function(e){e.preventDefault();e.stopPropagation()});this.resetEvents()},resetEvents:function(){this.previewElement.off("click");this.playElement.off("click");this.spinnerElement.off("click");this.addEvents()},addSpinner:function(){this.wrapper.append(this.spinnerElement);this.spinnerElement.hide()}};e.fn.gapPlayer=function(n){return this.each(function(){n=e.extend({},e.fn.gapPlayer.defaults,n);var r=new t(e(this),n);r.activate()})};e.fn.gapPlayer.defaults={label:"gif",autoLoad:false,preLoad:false,effect:false,hover:false};gapStart()})(jQuery)