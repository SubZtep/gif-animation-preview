/*
 * Based on:
 * Gifplayer v0.1.0
 * (c)2014 Rub√©n Torres - rubentdlh@gmail.com
 * Released under the MIT license
 */

(function(b){function e(a,c){this.previewElement=a;this.spinnerElement=b("<div class = 'spinner'></div>");this.options=c;this.gifLoaded=!1}e.prototype={activate:function(){this.wrap();this.addSpinner();this.addControl();this.addEvents();this.options.autoLoad&&(this.playElement.hide(),this.spinnerElement.show(),this.loadGif())},wrap:function(){this.wrapper=this.previewElement.wrap("<div class='gifplayer-wrapper'></div>").parent();this.wrapper.css("width",this.previewElement.width());this.wrapper.css("height",
this.previewElement.height());this.previewElement.addClass("gifplayer");this.previewElement.css("cursor","pointer")},getGifSrc:function(){return this.previewElement.attr("data-gif")?this.previewElement.attr("data-gif"):this.previewElement.attr("src").replace(/\.[^/.]+$/,".gif")},addControl:function(){this.playElement=b("<ins class='play-gif'>"+this.options.label+"</ins>");this.playElement.css("left",this.previewElement.width()/2+this.playElement.width()/2);this.wrapper.append(this.playElement)},addEvents:function(){var a=
this;a.playElement.on("click",function(c){b(this).hide();a.spinnerElement.show();a.loadGif();c.preventDefault();c.stopPropagation()});a.previewElement.on("click",function(c){a.playElement.is(":visible")&&(a.playElement.hide(),a.spinnerElement.show(),a.loadGif());c.preventDefault();c.stopPropagation()});a.spinnerElement.on("click",function(a){a.preventDefault();a.stopPropagation()})},loadGif:function(){this.gifLoaded||this.enableAbort();var a=this.getGifSrc(),c=this.previewElement.width(),e=this.previewElement.height();
this.gifElement=b("<img src='"+a+"' width='"+c+"' height=' "+e+" '/>");var d=this;this.gifElement.load(function(){d.gifLoaded=!0;d.resetEvents();b(this).css("cursor","pointer");b(this).css("position","absolute");b(this).css("top","0");b(this).css("left","0");d.previewElement.hide();d.wrapper.append(d.gifElement);d.spinnerElement.hide();b(this).click(function(a){b(this).remove();d.previewElement.show();d.playElement.show();a.preventDefault();a.stopPropagation()})})},enableAbort:function(){var a=this;
this.previewElement.click(function(c){a.abortLoading(c)});this.spinnerElement.click(function(c){a.abortLoading(c)})},abortLoading:function(a){this.spinnerElement.hide();this.playElement.show();a.preventDefault();a.stopPropagation();this.gifElement.off("load").on("load",function(a){a.preventDefault();a.stopPropagation()});this.resetEvents()},resetEvents:function(){this.previewElement.off("click");this.playElement.off("click");this.spinnerElement.off("click");this.addEvents()},addSpinner:function(){this.wrapper.append(this.spinnerElement);
this.spinnerElement.hide()}};b.fn.gapplayer=function(a){this.each(function(){a=b.extend({},b.fn.gapplayer.defaults,a);(new e(b(this),a)).activate()})};b.fn.gapplayer.defaults={label:"gif",autoLoad:!1}})(jQuery);